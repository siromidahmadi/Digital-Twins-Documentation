<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Luxury Documentation — Add Project</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="brand">
        <div class="logo-mark">DT</div>
        <div class="brand-text">
          <span class="brand-title">Digital Twins Project</span>
          <span class="brand-sub">Documentation</span>
        </div>
      </a>

      <nav class="nav">
        <a href="index.html" class="nav-link">Home</a>
        <a href="team.html" class="nav-link">Team</a>
        <a href="contact.html" class="nav-link">Contact</a>
      </nav>

      <button class="nav-toggle" aria-label="Toggle navigation" id="navToggle2">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <main>
    <section class="page container">
      <h1 class="page-title">Add Project</h1>
      <div class="card glow">
        <p class="lead">This form stores your project locally in your browser (no backend). It will appear alongside the JSON projects.</p>
      </div>

      <div id="formMsg" class="card glow" style="display:none;margin-top:12px"></div>

      <form id="addProjectForm" class="card glow" style="margin-top:16px">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
          <div>
            <label><strong>ID (slug)*</strong></label>
            <input type="text" id="f_id" required placeholder="e.g., ocean-watch" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff">
          </div>
          <div>
            <label><strong>Name*</strong></label>
            <input type="text" id="f_name" required placeholder="Project name" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff">
          </div>
          <div>
            <label><strong>Owner</strong></label>
            <input type="text" id="f_owner" placeholder="Your name/team" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff">
          </div>
          <div>
            <label><strong>Category*</strong></label>
            <select id="f_category" required style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff">
              <option value="">Select…</option>
              <option value="computer-science">Computer Science</option>
              <option value="architecture">Architecture</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px">
          <label><strong>Goal of the Project*</strong></label>
          <textarea id="f_goal" required rows="3" placeholder="Short paragraph" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff"></textarea>
        </div>

        <div style="margin-top:12px">
          <label><strong>Key Features</strong> (one per line)</label>
          <textarea id="f_features" rows="3" placeholder="Feature A\nFeature B" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff"></textarea>
        </div>

        <div style="margin-top:12px">
          <label><strong>File Structure</strong> (keep formatting)</label>
          <textarea id="f_fileStructure" rows="5" placeholder="/project\n├─ /dir\n└─ file" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff"></textarea>
        </div>

        <div style="margin-top:12px">
          <label><strong>Modular Architecture</strong> (one module per line: Title | Function | DataTypes comma | ProblemSolved)</label>
          <textarea id="f_modules" rows="4" placeholder="Ingest | Pull feeds | GeoJSON,CSV | Unifies formats" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff"></textarea>
          <div id="f_modules_preview" class="card glow" style="margin-top:8px;padding:12px">
            <em>Preview will appear here as you type.</em>
          </div>
        </div>

        <div style="margin-top:12px">
          <label><strong>Function of Each Module</strong> (one per line)</label>
          <textarea id="f_moduleFunctions" rows="3" placeholder="Ingest: Fetch & normalize\nAPI: Serve data" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff"></textarea>
        </div>

        <div style="margin-top:12px">
          <label><strong>Problem it Solves</strong></label>
          <textarea id="f_problem" rows="2" placeholder="What problem does this solve?" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff"></textarea>
        </div>

        <div style="margin-top:12px">
          <label><strong>Data Type it Works With</strong> (one per line)</label>
          <textarea id="f_dataTypes" rows="2" placeholder="GeoJSON\nCSV" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff"></textarea>
        </div>

        <div style="margin-top:12px">
          <label><strong>Conclusion</strong></label>
          <textarea id="f_conclusion" rows="3" placeholder="Summarize the outcome or next steps" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;color:#fff"></textarea>
        </div>

        <div style="margin-top:16px;display:flex;gap:12px">
          <button type="submit" class="btn btn-primary">Save Project</button>
          <a href="projects.html" class="btn btn-ghost">Cancel</a>
        </div>
      </form>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>© <span id="year2"></span> Alpha Earth — Documentation</div>
      <div class="footer-links">
        <a href="#">Contact</a>
        <a href="#">License</a>
      </div>
    </div>
  </footer>

  <script src="assets/js/main.js"></script>
  <script>
    (function(){
      function parseModules(text){
        return text.split('\n').map(function(line){
          var raw = line.trim();
          if(!raw) return null;
          var parts;
          if(raw.indexOf('|')>-1){ parts = raw.split('|'); }
          else if(raw.indexOf(':')>-1){ parts = raw.split(':'); }
          else if(raw.indexOf(' - ')>-1){ parts = raw.split(' - '); }
          else { parts = [raw]; }
          parts = parts.map(function(s){ return s.trim(); });
          var title = parts[0]||''; if(!title) return null;
          var fn = parts[1]||'';
          var dts = parts[2]||'';
          var dataTypes = dts.split(/[\/,]/).map(function(s){ return s.trim(); }).filter(Boolean);
          var prob = parts[3]||'';
          return { title: title, function: fn, dataTypes: dataTypes, problemSolved: prob };
        }).filter(Boolean);
      }
      function getLocal(){
        try{ return JSON.parse(localStorage.getItem('localProjects')||'[]'); }catch(e){ return []; }
      }
      function setLocal(arr){ localStorage.setItem('localProjects', JSON.stringify(arr)); }
      function msg(type, text){
        var el = document.getElementById('formMsg');
        el.style.display='block';
        el.style.borderColor = type==='error' ? 'rgba(255,80,80,0.2)' : 'rgba(201,162,74,0.2)';
        el.innerHTML = text;
      }
      function fetchJSON(){
        return fetch('assets/data/projects.json').then(function(r){ if(!r.ok) throw new Error(); return r.json(); });
      }
      function findAnyById(id){
        var locals = getLocal();
        var found = locals.find(function(p){ return p.id===id; });
        if(found) return Promise.resolve(found);
        return fetchJSON().then(function(d){
          var arr = (d && d.projects)||[];
          return arr.find(function(p){ return p.id===id; }) || null;
        }).catch(function(){ return null; });
      }

      // Edit mode prefill
      var params = new URLSearchParams(window.location.search);
      var edit = params.get('edit') === '1';
      var editId = params.get('id');
      if(edit && editId){
        findAnyById(editId).then(function(p){
          if(!p){ msg('error','Could not load project to edit: '+editId); return; }
          document.getElementById('f_id').value = p.id;
          document.getElementById('f_id').setAttribute('disabled','disabled');
          document.getElementById('f_name').value = p.name||'';
          document.getElementById('f_owner').value = p.owner||'';
          document.getElementById('f_category').value = (p.category||'');
          document.getElementById('f_goal').value = p.goal||'';
          document.getElementById('f_features').value = (p.features||[]).join('\n');
          document.getElementById('f_fileStructure').value = p.fileStructure||'';
          document.getElementById('f_modules').value = (p.modularArchitecture||[]).map(function(m){
            return (m.title||'')+' | '+(m.function||'')+' | '+((m.dataTypes||[]).join(','))+' | '+(m.problemSolved||'');
          }).join('\n');
          document.getElementById('f_moduleFunctions').value = (p.moduleFunctions||[]).join('\n');
          document.getElementById('f_problem').value = p.problem||'';
          document.getElementById('f_dataTypes').value = (p.dataTypes||[]).join('\n');
          var concl = document.getElementById('f_conclusion');
          if(concl) concl.value = p.conclusion||'';
        });
      }

      // Live preview for Modular Architecture
      (function(){
        var ta = document.getElementById('f_modules');
        var pv = document.getElementById('f_modules_preview');
        if(ta && pv){
          function render(){
            var mods = parseModules(ta.value);
            if(mods.length===0){ pv.innerHTML = '<em>No modules parsed yet.</em>'; return; }
            pv.innerHTML = mods.map(function(m){
              return '<div style="margin:6px 0"><strong>'+m.title+'</strong>'
                + (m.function?': '+m.function:'')
                + (m.dataTypes && m.dataTypes.length? ' — ['+m.dataTypes.join(', ')+']':'')
                + (m.problemSolved? ' — '+m.problemSolved:'')
                + '</div>';
            }).join('');
          }
          ta.addEventListener('input', render);
          render();
        }
      })();

      document.getElementById('addProjectForm').addEventListener('submit', function(e){
        e.preventDefault();
        var idInput = document.getElementById('f_id');
        var id = idInput.value.trim();
        var name = document.getElementById('f_name').value.trim();
        var owner = document.getElementById('f_owner').value.trim();
        var category = document.getElementById('f_category').value.trim();
        var goal = document.getElementById('f_goal').value.trim();
        if(!id || !name || !category || !goal){
          msg('error', 'Please fill required fields: ID, Name, Category, Goal.');
          return;
        }
        var features = document.getElementById('f_features').value.split('\n').map(s=>s.trim()).filter(Boolean);
        var fileStructure = document.getElementById('f_fileStructure').value;
        var modules = parseModules(document.getElementById('f_modules').value);
        var moduleFunctions = document.getElementById('f_moduleFunctions').value.split('\n').map(s=>s.trim()).filter(Boolean);
        var problem = document.getElementById('f_problem').value.trim();
        var dataTypes = document.getElementById('f_dataTypes').value.split('\n').map(s=>s.trim()).filter(Boolean);
        var conclusion = (document.getElementById('f_conclusion')||{value:''}).value.trim();

        var locals = getLocal();
        var proj = { id, name, owner, category, goal, features, fileStructure, modularArchitecture: modules, moduleFunctions, problem, dataTypes, conclusion };
        if(edit && editId && editId===id){
          locals = locals.filter(function(p){ return p.id!==id; });
          locals.push(proj);
        } else {
          if(locals.some(function(p){ return p.id===id; })){
            msg('error','A local project with this ID already exists. Choose another ID or open in Modify mode.');
            return;
          }
          locals.push(proj);
        }
        setLocal(locals);
        msg('ok','Saved! Redirecting…');
        setTimeout(function(){ window.location.href = 'project.html?id=' + encodeURIComponent(id); }, 600);
      });
    })();
  </script>
</body>
</html>
